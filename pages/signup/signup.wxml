<include src="../../utils/alert/alert.wxml" />
<loading hidden="{{!loading}}">
  loading...
</loading>

<view class="page">
  <view class="page__hd">
    <view class="page__title">Upcoming Event</view>
  </view>
  <view class="page__bd">
    <view class="weui-cells weui-cells_after-title" wx:if="{{hasUpcomingEvent}}">

      <!-- Upcoming Event Title -->
      <view class="weui-cell">
        <view class="weui-cell__bd">Event Name</view>
        <view class="weui-cell__ft">MWH (Moral Welfare Home)</view>
      </view>

      <!-- Upcoming Event Information -->
      <view class="weui-cells weui-cells_after-title">
        <view class="weui-cell">
          <view class="weui-cell__bd">Date</view>
          <view class="weui-cell__ft">{{eventItem.fullDate}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">Time</view>
          <view class="weui-cell__ft">{{eventItem.time}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">Deadline</view>
          <view class="weui-cell__ft">{{eventItem.fullDeadline}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">Limit</view>
          <view class="weui-cell__ft">{{eventItem.limit}}</view>
        </view>
      </view>

      <!-- *****Terms of service***** -->
      <!-- show info if the event is not open yet -->
      <label class="weui-agree" wx:if="{{isNotYet}}">
        <view>Sign up for upcoming event is not open yet. Please be patient :)</view>
        <view>You can also contact project director if you have any questions.
          <view bindtap="showContactPD" class="weui-agree__link">How?</view>
        </view>
      </label>

      <!-- show info if the event is closed -->
      <label class="weui-agree" wx:if="{{isClosed}}">
        Sign up for upcoming event is closed. Please contact project director if you have any further queries. (e.g. join/quit)
        <view bindtap="showContactPD" class="weui-agree__link">How?</view>
      </label>


      <!-- Before Sign Up -->
      <checkbox-group bindchange="bindAgreeChange" wx:if="{{!isSignedUp}}">
        <label class="weui-agree" for="weuiAgree">
          <view class="weui-agree__text">
            <checkbox class="weui-agree__checkbox" id="weuiAgree" value="agree" checked="{{isAgree}}" />
            <view class="weui-agree__checkbox-icon">
              <icon class="weui-agree__checkbox-icon-check" type="success_no_circle" size="15" wx:if="{{isAgree}}"></icon>
            </view>
            I've read the
            <view bindtap="showNotice" class="weui-agree__link">Terms of service</view>
          </view>
        </label>
      </checkbox-group>

      <!--After signup: Update Status -->
      <label class="weui-agree" for="weuiAgree" wx:else>
        <view class="weui-agree__text" wx:if="{{isWaiting}}">You are in the waiting list.</view>
        <view class="weui-agree__text" wx:else>You have successfully signed up.</view>
        <view bindtap="showNotice" class="weui-agree__link">Terms of service</view>
      </label>

      <!-- ***** Submit or Quit Button ***** -->
      <!-- Before Sign Up: Button set to SignUp-->
      <button class="weui-btn" type="primary" bindtap="sighUpBtnClick" disabled="{{!isSignUpAllowed || isClosed}}" wx:if="{{!isSignedUp|| isClosed}}">{{btnText}}</button>

      <!-- After Sign Up: Button set to Quit-->
      <button class="weui-btn" type="default" bindtap="quitBtnClick" disabled="" wx:else> Quit </button>
    </view>
    <view class="weui-form-preview__bd" wx:else>
      <view class="weui-form-preview__value_in-hd">No Upcoming Event</view>
    </view>
  </view>
  <!-- End page__bd -->

  <!-- Display volunteer list -->
  <view class="page__bd">
    <view class="page__title" wx:if="{{volunteerList.length > 0}}">{{numPeopleJoined}} people have joined.</view>

<view class='volunteerBlock'>
    <block wx:if="{{volunteerList.length > 0}}">
    <text class="page__desc" >Volunteer List:</text>
      <view class="weui-cells weui-cells_after-title" wx:for="{{volunteerList}}" wx:key="volunteerItem">
        <view class="weui-cell">
          <view class="weui-cell__hd">
            <image src="{{item.user.avatarUrl}}" class="avatar" mode="aspectFit"></image>
          </view>
          <view class="weui-cell__bd">{{item.user.realName}}</view>
          <view class="weui-cell__ft">{{item.updatedAt}}</view>
        </view>
      </view>
    </block>
    </view>

<view class='waitlingBlock'>
    <block wx:if="{{waitingList.length > 0}}">
    <text class="page__desc">WaitingList List:</text>
      <view class="weui-cells weui-cells_after-title" wx:for="{{waitingList}}" wx:key="volunteerItem">
        <view class="weui-cell">
          <view class="weui-cell__hd">
            <image src="{{item.user.avatarUrl}}" class="avatar" mode="aspectFit"></image>
          </view>
          <view class="weui-cell__bd">{{item.user.realName}}</view>
          <view class="weui-cell__ft">{{item.updatedAt}}</view>
        </view>
      </view>
    </block>
    </view>
  </view>
</view>
<!-- End page -->




<!-- ***** popup Notice panel to display Terms of service *****-->
<view class="notice" id="notice" wx:if="{{notice_status}}">
  <scroll-view lower-threshold="800" upper-threshold="0" scroll-y="true" style="height: {{windowHeight}}px;">
    <view class="box">
      <view class="box-hd">
        <text class="box-title">发起须知</text>
      </view>
      <view class="box-bd">
        <view class="notice-q">1、为什么需要填写真实姓名与联系方式等信息？</view>
        <view class="notice-a">
          <text>线上报名，线下联系；填写真实有效的联系信息更加有利于活动的开展</text>
          <text>联系方式有三种选择，分别是微信号，QQ号以及手机号，这三种联系方式在目前生活中是最为普遍的</text>
          <text>当有用户报名您的发起时，即可查看您填写的联系信息，以便加入者与您联系,没有加入的用户无法查看您的联系信息</text>
          <text>活动的群二维码主要用于活动的交流与联系,可以视活动的大小上传或者不上传</text>
        </view>
        <view class="notice-q">2、发起内容的有哪些限制？</view>
        <view class="notice-a">
          <text>发起内容应该在法律允许的范围内，如果发起内容违反了相关的法律法规，一经发现，本软件有权限对该发起进行删除操作</text>
        </view>
        <view class="box-bd">
          <view class="notice-q">1、为什么需要填写真实姓名与联系方式等信息？</view>
          <view class="notice-a">
            <text>线上报名，线下联系；填写真实有效的联系信息更加有利于活动的开展</text>
            <text>联系方式有三种选择，分别是微信号，QQ号以及手机号，这三种联系方式在目前生活中是最为普遍的</text>
            <text>当有用户报名您的发起时，即可查看您填写的联系信息，以便加入者与您联系,没有加入的用户无法查看您的联系信息</text>
            <text>活动的群二维码主要用于活动的交流与联系,可以视活动的大小上传或者不上传</text>
          </view>
          <view class="notice-q">2、发起内容的有哪些限制？</view>
          <view class="notice-a">
            <text>发起内容应该在法律允许的范围内，如果发起内容违反了相关的法律法规，一经发现，本软件有权限对该发起进行删除操作</text>
          </view>
          <view class="weui-btn-area">
            <button class="weui-btn" type="primary" bindtap="hideNotice">确定</button>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>

<!-- Sumbit User information Panel -->
<view class="noticePanel" style="opacity: 1;" wx:if="{{isSubmitingUserInfo}}">
  <view class='box'>
    <view class="weui-mask"></view>
    <view class="page_container">
      <view class="page__hd">
        <view class="page__desc">Please fill in your information</view>
      </view>
      <view class="weui-dialog weui-skin_android">
        <form bindsubmit="submitUserInfo">
          <view class="weui-dialog__bd">
            <view class="weui-cells__title">Full Name (Pinyin)</view>
            <view class="weui-cells weui-cells_after-title">
              <view class="weui-cell weui-cell_input">
                <view class="weui-cell__bd">
                  <input class="weui-input" name="realName" />
                </view>
              </view>
            </view>

            <view class="weui-cells__title">Contact number</view>
            <view class="weui-cells weui-cells_after-title">
              <view class="weui-cell weui-cell_input">
                <view class="weui-cell__bd">
                  <input class="weui-input" name="phone" />
                </view>
              </view>
            </view>
          </view>
          <view class="weui-btn-area">
            <button class="weui-btn" type="default" bindtap="cancelBtnClick">Cancel</button>
            <button class="weui-btn" type="primary" formType="submit">Submit</button>
          </view>
        </form>
      </view>
    </view>
  </view>
</view>